CREATE DATABASE BAITHI 
USE BAITHI

CREATE TABLE CSCHANNUOI (
	MACS NVARCHAR(5) PRIMARY KEY,
	TENCS NVARCHAR(30),
	LOAICS NVARCHAR(50),
	NGDAIDIEN NVARCHAR(50),
	NGTL SMALLDATETIME,
	DTHOAI VARCHAR(15) 
);
CREATE TABLE GIONGVN (
	MAGIONG NVARCHAR(4) PRIMARY KEY,
	TENGIONG NVARCHAR(50),
	LOAIVN NVARCHAR(20)
);
CREATE TABLE DIEUKIENCN (
	MADK NVARCHAR(5) PRIMARY KEY,
	MACS NVARCHAR(5),
	CONSTRAINT FK_MCS_DK FOREIGN KEY(MACS) REFERENCES CSCHANNUOI(MACS),
	QUYMO INT,
	KCXLCT INT,
	KCKDC INT
);
CREATE TABLE GPCN (
	MAGP NVARCHAR(5) PRIMARY KEY,
	MACS NVARCHAR(5),
	CONSTRAINT FK_MACS_GP FOREIGN KEY(MACS) REFERENCES CSCHANNUOI(MACS),
	NGCAP SMALLDATETIME,
	SOGP NVARCHAR(50),
	SOGIONG INT
);
CREATE TABLE CTGP (
	MAGP NVARCHAR(5),
	MAGIONG NVARCHAR(4),
	SL INT,
	CONSTRAINT PK_CTGP PRIMARY KEY(MAGP,MAGIONG),
	CONSTRAINT FK_MGP_CTGP FOREIGN KEY (MAGP) REFERENCES GPCN(MAGP),
	CONSTRAINT FK_MG_CTGP FOREIGN KEY (MAGIONG) REFERENCES GIONGVN(MAGIONG)
);
CREATE TABLE DOTCN (
	MADOTCN NVARCHAR(4) PRIMARY KEY,
	MACS NVARCHAR(5),
	CONSTRAINT FK_MCS_DCN FOREIGN KEY(MACS) REFERENCES CSCHANNUOI(MACS),
	MAGIONG NVARCHAR(4),
	CONSTRAINT FK_MG_DCN FOREIGN KEY (MAGIONG) REFERENCES GIONGVN(MAGIONG),
	SLVN INT,
	NGBD SMALLDATETIME,
	PHGTHUC NVARCHAR(50),
	NGXUAT SMALLDATETIME
);

ALTER TABLE CSCHANNUOI
ALTER COLUMN TENCS NVARCHAR(100);

SET DATEFORMAT DMY

INSERT INTO CSCHANNUOI VALUES 
('CS001', 'Hoang mai', 'Nong ho', 'Nguyen Thanh Son', '19/10/2019', '0971507394'),
('CS002', 'Cong ty TNHH Phung Dầu Sơn', 'Trang trai quy mo vua','Pham The Hung', '20/10/2009', '0364266792'),
('CS003', 'Green Farm', 'Trang trai quy mo nho', 'Ho Trung Dai', '15/09/2018', '0356266782')

INSERT INTO GIONGVN VALUES
('G001', 'Bo vang Viet Nam', 'Bo'),
('G002', 'Bo Bay Nui', 'Bo'),
('G003', 'De nui Ninh Binh', 'De')

INSERT INTO DIEUKIENCN VALUES
('DK001', 'CS001', 10, 250, 300),
('DK002', 'CS001', 10, 200, 350),
('DK003', 'CS003', 30, 350, 400)

INSERT INTO GPCN VALUES
('GP001', 'CS001', '10/10/2020', '42/001/2020/DKCN', 1),
('GP002', 'CS001', '08/09/2020', '43/001/2020/DKCN', 2),
('GP003', 'CS002', '04/06/2010', '2/002/2010/DKCN', 4)

INSERT INTO CTGP VALUES
('GP001', 'G001', 10),
('GP002', 'G002', 10),
('GP002', 'G003', 10)

INSERT INTO DOTCN VALUES
('D001', 'CS001', 'G001', 5,'15/06/2021','Tha tu do','15/05/2023'),
('D002', 'CS001', 'G002', 5, '15/07/2021', 'Tha tu do', '10/05/2023'),
('D003', 'CS003', 'G001', 25, '20/09/2021', 'Tha tu do','10/03/2022')

ALTER TABLE DOTCN
ADD CONSTRAINT chk_dcn CHECK (SLVN >= 100 OR PHGTHUC NOT IN ('thả tự do'))